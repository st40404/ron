source: https://github.com/MegviiRobot/CamLaserCalibraTool?fbclid=IwAR1Z0EfF-nob7_EnLt4s18m7HLzTtkSD8GYvJvpjRyhNKk77QFO9csEjb-g

mkdir -p LaserCameraCal_ws/src
cd LaserCameraCal_ws/src
git clone https://github.com/MegviiRobot/CamLaserCalibraTool

## install cere
## following the manual(debug) : need to install ceres 

## compile and check system in sim mode
    cd ..
    catkin_make -DCMAKE_BUILD_TYPE=Release

    . devel/setup.bash 
    roscore
    rosrun lasercamcal_ros simulation_lasercamcal_node

## get the kalibr from realsense(install kalibr for the calibration bag & log)

    mkdir -p ~/kalibr_workspace/src
    cd ~/kalibr_workspace/src
    git clone https://github.com/ethz-asl/Kalibr.git

    cd ~/kalibr_workspace
    catkin build -DCMAKE_BUILD_TYPE=Release -j4

    ## goto your kalibr workspace to make a apriltag
    . devel/setup.bash

    rosrun kalibr kalibr_create_target_pdf --type apriltag --nx 6 --ny 6 --tsize 0.088 --tspace 0.3

    ## make a bag and yaml
        ## put realsense driver in LaserCameraCal_ws/src
        cd ~/LaserCameraCal_ws/src
        git clone https://github.com/intel-ros/realsense.git
        git clone https://github.com/pal-robotics/ddynamic_reconfigure.git
        cd ..
        catkin_make -DCMAKE_BUILD_TYPE=Release

        ## go to LaserCameraCal_ws
        roslaunch realsense2_camera rs_camera.launch
        rosrun topic_tools throttle messages /camera/color/image_raw 4.0 /color

        ## open rosbag to save this topic
        rosbag record -O camd435i /color

        ## put your apriltag in front of your camera and move it 
        ## after trying lots of position and gesture, Ctri+c to close this bag and save

        ## make a file in LaserCameraCal_ws/src
        cd ~/LaserCameraCal_ws/src
        mkdir bagfiles

        ## put camd435i.bag, aprilgrid.yaml in bagfiles, and make a log file

kalibr_calibrate_cameras --models pinhole-radtan --topics /color --bag ~/LaserCameraCal_ws/src/bagfiles/camd435i.bag --target ~/LaserCameraCal_ws/src/bagfiles/aprilgrid.yaml



        ## aprilgrid.yaml (make by your self)
        ## A0 paper
            target_type: 'aprilgrid' #gridtype
            tagCols: 6               #number of apriltags
            tagRows: 6               #number of apriltags
            tagSize: 0.088           #size of apriltag, edge to edge [m]
            tagSpacing: 0.3          #ratio of space between tags to tagSize
                                     #example: tagSize=2m, spacing=0.5m --> tagSpacing=0.25[-]
        ## A4 paper
            target_type: 'aprilgrid' #gridtype
            tagCols: 6               #number of apriltags
            tagRows: 6               #number of apriltags
            tagSize: 0.025           #size of apriltag, edge to edge [m]
            tagSpacing: 0.32         #ratio of space between tags to tagSize
                                     #example: tagSize=2m, spacing=0.5m --> tagSpacing=0.25[-]

        ## make a log file in bagfiles
            mkdir log

## change calibra_config.yaml 
    ## go to ~/LaserCameraCal_ws/src/CamLaserCalibraTool/config
        vim calibra_config.yaml
    ## change the savePath to your log
        savePath: "/home/st40404/LaserCameraCal_ws/src/bagfiles/log/"
    ## change the savePath to your bag
        bag_path: "/home/st40404/LaserCameraCal_ws/src/bagfiles/camd435i.bag"
    ## set your tag info
        tag_type: 2       # 1: kalibr_tag, 2: apriltag
        tag_size: 0.025   # tag size, unit meter
        tag_spacing: 0.32 # tag spacing, only used in kalibr_tag. For details, please see kalibr tag description. 
        black_border: 1   # kalibr_tag black_boarder = 2, apriltag black_boarder = 1
    ## set camera calibration 
        ## if you use realsense 435i
            model_type: PINHOLE
            camera_name: camera
        ## to get image_width and image_heigh from camera_info
        roslaunch realsense2_camera rs_camera.launch
        rostopic echo /camera/color/camera_info

        image_width: 1280
        image_height: 720
    
    ## set your projection parameters
        ## get fx, fy, cx, cy from camera_info
        roslaunch realsense2_camera rs_camera.launch
        rostopic echo /camera/color/camera_info

        ## K:[x1, x2, x3, y1, y2, y3, z1, z2, z3]
        fx: x1
        fy: y2
        cx: x3
        xy: y3



## check camera info
rostopic echo /camera/color/camera_info 